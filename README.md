# AgenticRenderer

A 3D rendering engine built in C++20, featuring modern graphics techniques and supporting both Vulkan and Direct3D 12 APIs.

All code, including this readme, are mostly generated by AI Agents under close supervision.

## Features

### Core Rendering Pipeline
- **Deferred Rendering**: Multi-pass architecture with G-Buffer containing albedo, normals, ORM (occlusion/roughness/metallic), emissive, and motion vector channels
- **Physically-Based Rendering (PBR)**: Full PBR material support with metallic/roughness workflow, including transmission and thickness
- **HDR Rendering**: High dynamic range pipeline with histogram-based automatic exposure adaptation (EV100) and tone mapping
- **Ray-Traced Shadows**: Hardware-accelerated ray tracing for directional light shadows
- **Bloom**: Multi-stage bloom post-processing with configurable intensity and knee parameters

### Advanced Rendering Techniques
- **Meshlet Rendering**: GPU-driven rendering using meshlets for efficient geometry processing
- **Bindless Textures**: Descriptor indexing for unlimited texture access without binding changes
- **Hierarchical Z-Buffer (HZB)**: Multi-level depth buffer for efficient occlusion culling using AMD Single Pass Downsampler (SPD)
- **GPU Culling**: Compute shader-based frustum, cone, and occlusion culling
- **Multi-threaded Rendering**: Parallel command list recording and task scheduling
- **Image-Based Lighting (IBL)**: Environment lighting with irradiance and radiance cubemaps

### Scene Management
- **glTF 2.0 Support**: Complete scene loading with meshes, materials, textures, animations, lights, and cameras
- **Scene Caching**: Binary scene cache for fast loading and reduced memory usage
- **Dynamic Lighting**: Directional light support with PBR lighting models and attenuation
- **Mesh Optimization**: Vertex quantization and mesh optimization using meshoptimizer

### Performance & Profiling
- **Microprofile Integration**: Detailed CPU and GPU performance profiling and visualization
- **Pipeline State Caching**: Automatic caching of graphics and compute pipelines
- **Command List Batching**: Efficient command list recording and execution

### Developer Experience
- **ImGui UI**: Real-time debugging interface with performance metrics, render settings, and visualization options
- **Cross-API**: Windows support with Vulkan and Direct3D 12 backends
- **Modern C++**: C++20 features with clean, maintainable architecture
- **Shader Hot Reloading**: Runtime shader recompilation and reloading

## Architecture

The engine uses a modular renderer architecture where different rendering passes are implemented as separate renderer classes:

- **BasePassRenderer**: Geometry pass with G-Buffer generation and GPU culling
- **DeferredRenderer**: Deferred lighting and shading with ray-traced shadows
- **BloomRenderer**: Multi-stage bloom post-processing
- **HDRRenderer**: Post-processing with histogram-based exposure and tone mapping
- **TransparentPassRenderer**: Forward rendering for transparent objects
- **ImGuiRenderer**: UI rendering

### Graphics Abstraction
Built on top of NVRHI (NVIDIA Rendering Hardware Interface) providing:
- Unified API for Vulkan and Direct3D 12
- Automatic resource state management
- Cross-API shader compilation (SPIR-V/DXIL)

## Dependencies

The project automatically downloads and builds the following dependencies:
- **[SDL3](https://www.libsdl.org/)**: Cross-platform windowing and input
- **[NVRHI](https://github.com/NVIDIA-RTX/NVRHI)**: Graphics API abstraction layer
- **[ImGui](https://github.com/ocornut/imgui)**: Immediate mode GUI
- **[cgltf](https://github.com/jkuhlmann/cgltf)**: glTF 2.0 parsing
- **[DirectX Shader Compiler (DXC)](https://github.com/microsoft/DirectXShaderCompiler)**: HLSL compilation
- **[ShaderMake](https://github.com/NVIDIA-RTX/ShaderMake)**: Offline shader compilation tool
- **[meshoptimizer](https://github.com/zeux/meshoptimizer)**: Mesh optimization and quantization
- **[microprofile](https://github.com/jonasmr/microprofile)**: Performance profiling
- **[stb_image](https://github.com/nothings/stb)**: Image loading

## Usage

### Command Line Options
- `--scene <path>`: Load a scene file
- `--vulkan`: Select Vulkan graphics API (default: D3D12)
- `--rhidebug`: Enable graphics API validation layers
- `--rhidebug-gpu`: Enable GPU-assisted validation (requires --rhidebug)
- `--skip-textures`: Skip loading textures from scene
- `--skip-cache`: Skip loading/saving scene cache
- `--irradiance <path>`: Path to irradiance cubemap texture (DDS)
- `--radiance <path>`: Path to radiance cubemap texture (DDS)
- `--envmap <path>`: Path to environment map (auto-infers irradiance/radiance DDS files)
- `--brdflut <path>`: Path to BRDF LUT texture (DDS)
- `--execute-per-pass`: Execute command lists per pass
- `--execute-per-pass-and-wait`: Wait for idle after each pass execution
- `--help, -h`: Show help message

### Example
```bash
AgenticRenderer.exe --scene scenes/sponza.gltf --vulkan --rhidebug
```

### Controls
- **Mouse**: Camera rotation and movement
- **WASD**: Camera movement

## Shader System

Shaders are written in HLSL and compiled offline to both SPIR-V (Vulkan) and DXIL (Direct3D 12) using ShaderMake. The shader configuration is defined in `src/shaders/shaders.cfg`.

Key shader features:
- **Shader Model 6.8**: Latest HLSL features including mesh shaders and ray tracing
- **Bindless Resources**: Descriptor indexing for textures and buffers
- **Ray Tracing**: Inline ray tracing for shadows
- **Mesh Shaders**: GPU-driven geometry processing
- **Compute Shaders**: For culling, histogram generation, and post-processing

## Scene Format Support

This application supports loading scene files in the following formats:

- **glTF (.gltf)**: Standard glTF 2.0 files (text-based only, GLB binary format not supported)
- **Scene JSON (.scene.json)**: Custom JSON scene format

### Sample Scenes

You can download sample scenes from the following NVIDIA repositories:
- **[RTXPT-Assets](https://github.com/NVIDIA-RTX/RTXPT-Assets)**: Path tracing sample assets
- **[RTXDI-Assets](https://github.com/NVIDIA-RTX/RTXDI-Assets)**: RTX Direct Illumination sample assets

### Supported Features
- **Meshes**: Triangle meshes with vertex quantization and mesh optimization
- **Materials**: PBR materials with albedo, normal, ORM, emissive textures, transmission, and thickness
- **Animations**: Skeletal animations with linear, step, and cubic spline interpolation
- **Lights**: Directional lights with attenuation and ray-traced shadows
- **Cameras**: Perspective cameras with configurable parameters and EV100 exposure
